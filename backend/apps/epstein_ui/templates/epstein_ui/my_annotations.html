{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Annotations - Epstein Studio</title>
    <link rel="icon" href="{% static 'epstein_ui/favicon.ico' %}" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'epstein_ui/style-modern.css' %}" />
  </head>
  <body>
    <div class="page">
      <header class="topbar">
        <div class="topbar-row">
          <div class="topbar-left">
            <a href="/" class="brand">Epstein Studio</a>
          </div>
          <div class="topbar-actions">
            <a class="btn btn-secondary" href="/browse/">Browse</a>
            <a class="btn btn-secondary" href="/about/">About</a>
            <details class="account-menu">
              <summary class="account-button" aria-label="Account">
                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="7" r="4"></circle>
                  <path d="M4 20c1.7-3.6 5-6 8-6s6.3 2.4 8 6"></path>
                </svg>
              </summary>
              <div class="account-dropdown">
                <div class="account-username">{{ request.user.username }}</div>
                <a class="account-link active" href="/my-annotations/">My Annotations</a>
                <a class="account-link" href="/notifications/">Notifications</a>
                <a class="account-link" href="/logout/">Logout</a>
              </div>
            </details>
          </div>
        </div>
      </header>

      <main class="my-annotations-page">
        <div class="my-annotations-content">
          <div class="my-annotations-header">
            <h1 class="my-annotations-title">My Contributions</h1>
            <p class="my-annotations-subtitle">Your annotations and comments across all documents</p>
          </div>

          <div class="my-annotations-tabs">
            <button class="my-annotations-tab active" data-tab="annotations">
              Annotations <span class="my-annotations-count">{{ annotations|length }}</span>
            </button>
            <button class="my-annotations-tab" data-tab="comments">
              Comments <span class="my-annotations-count">{{ pdf_comments|length }}</span>
            </button>
          </div>

          <div class="my-annotations-panel active" data-panel="annotations">
            {% if annotations %}
              <div class="my-annotations-list">
                {% for ann in annotations %}
                  <a href="/{{ ann.pdf_key }}/{{ ann.hash }}/" class="my-annotation-card">
                    <div class="my-annotation-doc">
                      <svg viewBox="0 0 24 24" width="16" height="16"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                      {{ ann.pdf_key }}.pdf
                    </div>
                    <div class="my-annotation-note">{{ ann.note|truncatechars:150 }}</div>
                    <div class="my-annotation-meta">
                      <span class="my-annotation-date">{{ ann.created_at|date:"M j, Y" }}</span>
                      <span class="my-annotation-stats">
                        {{ ann.vote_score }} votes &middot; {{ ann.comment_count }} comments
                      </span>
                    </div>
                  </a>
                {% endfor %}
              </div>
            {% else %}
              <div class="my-annotations-empty">
                <svg viewBox="0 0 24 24" width="48" height="48"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                <p>You haven't created any annotations yet.</p>
                <a class="btn" href="/browse/">Start Exploring</a>
              </div>
            {% endif %}
          </div>

          <div class="my-annotations-panel" data-panel="comments">
            {% if pdf_comments %}
              <div class="my-annotations-list">
                {% for comment in pdf_comments %}
                  <a href="/{{ comment.pdf.filename|cut:'.pdf' }}/{{ comment.hash }}/" class="my-annotation-card">
                    <div class="my-annotation-doc">
                      <svg viewBox="0 0 24 24" width="16" height="16"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                      {{ comment.pdf.filename }}
                    </div>
                    <div class="my-annotation-note">{{ comment.body|truncatechars:150 }}</div>
                    <div class="my-annotation-meta">
                      <span class="my-annotation-date">{{ comment.created_at|date:"M j, Y" }}</span>
                      <span class="my-annotation-stats">
                        {{ comment.replies.count }} replies
                      </span>
                    </div>
                  </a>
                {% endfor %}
              </div>
            {% else %}
              <div class="my-annotations-empty">
                <svg viewBox="0 0 24 24" width="48" height="48"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <p>You haven't posted any comments yet.</p>
                <a class="btn" href="/browse/">Join the Discussion</a>
              </div>
            {% endif %}
          </div>
        </div>
      </main>
    </div>

    <script>
      document.querySelectorAll('.my-annotations-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.my-annotations-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.my-annotations-panel').forEach(p => p.classList.remove('active'));
          tab.classList.add('active');
          document.querySelector(`[data-panel="${tab.dataset.tab}"]`).classList.add('active');
        });
      });
    </script>
  </body>
</html>
